# 运输车辆调度优化与仿真模拟 TODO list

---

---

[TOC]

> 标题说明：
> 标题为 *斜体* 代表该部分并非必要实现内容，应在其他内容实现完毕后再酌情选择性实现

---

## 后端

#### 订单生成链条

- [x] 增加新类：兴趣点类`POI`

  > 兴趣点类作为所有兴趣点的抽象父类
  >
  > 将三种生产厂`*Producer`和三种加工厂`*Processor`改为兴趣点类的子类`Producer, Processor`，其种类被自身属性`ProductType`标定

- [ ] 实现兴趣点`POI`的加载逻辑

  > 在初始化时将需要的兴趣点加载至内存，形式应类似于`Car`或`Demand`类

- [x] 实现厂商类的更新逻辑

  > 厂商数据应定时更新，且更新全过程应由后端独立完成

- [x] 为加工厂`Processor`添加新属性`stock, upBound, lowBound`

  > 加工厂在接收订单后按照一定折损率增加库存`stock: int`，并且拥有上阈值`upBound: int`与下阈值`lowBound: int`，作用详见[库存定需](#stock-usage)

  > 注：上下阈值不是上下限，不能抛弃超阈部分的值

- [x] 增加新类：市场类 `Market`

  > 市场对应现实中的家具城、五金店等，可以生成货运订单`Demand`，逻辑详见[市场下单](#market-demand)
  >
  > 市场类为兴趣点类的子类

- [x] 订单由随机生成转为厂商按需生成

  > 具体表现为：
  >
  > - [x] <span id="stock-usage">加工厂在库存低于下阈值时随机寻找相同产品种类`ProductType`的生产厂`Processor`，生成货运订单，直至库存达到上阈值</span>
  > - [ ] 加工厂有概率寻找其他有库存的同类加工厂而非生产厂，生成货运订单
  > - [ ] <span id="market-demand">市场每个周期有概率购买库存足够的加工厂产品，生成货运订单</span>
  
  > 注：市场需求订单生成与加工厂库存是否超阈值无关，仅检测库存量是否满足订单需求量；所有厂商（包括市场）在已有订单时均不会生成订单

#### 调度器主体编写

- [ ] 完成调度器主体编写

  > 需要实现一车多货情景下的调度逻辑，要求能够处理 A~终~-B~起~-B~终~ 以及 A~起~-B~起~-B~终~-A~终~ 等情况下的订单合理分配
  
- [ ] 调度器数据接口

  > 完成调度器择优比较的参数接口，保证统计数据的轻松获取

#### 模拟调度

- [ ] 天气影响

  > 引入天气对工作速度、随机事件概率的影响

- [ ] 时间影响

  > 引入一天当中不同时间对工作速度、随机事件概率的影响

#### 数据沙箱

- [ ] 停止程序再运行

  > 实现模拟数据的读取、解析、加载、运行逻辑

#### *调度器升级优化*

- [ ] 双参载重模型

  > 从 使用载重计算代价，体积作为限制 变为 载重和体积共同计算代价

- [ ] 多货多车模型

  > 在一货多车的基础上实现多货多车货运逻辑

- [ ] 个体差异模型

  > 在引入差异化司机的情况下进行个人利好型接单调度逻辑

#### *次要调度器编写*

- [ ] 完善其他算法调度器

  > - [ ] 先来先服务算法 (FCFS) 调度器
  > - [ ] 贪心算法 (Greedy) 调度器
  > - [ ] 模拟退火算法 (Simulated Annealing) 调度器

- [ ] 代价计算函数

  > 完成其他调度器的代价计算函数接口，与主体调度器的择优比较参数对标

#### *随机事件*

- [ ] 随机数生成规范化

  > 统一随机类`Random`生成的随机数，使其可被单一可配置或分别独立可配置的随机种子控制

- [ ] 个体差异化事件

  > 模拟差异化司机在复杂环境行进过程中经历随机事件导致的"意外"状态转换

#### *细化订单生成链条*

- [ ] 细化加工厂库存增加逻辑

  > 加工厂在接收货物后将其加至加工缓存`processBuffer: int`，每个周期按折损率将一定量的加工缓存转为库存
  >
  > 若本条实现，则后续可能需要完善[精工厂库存](#refiner-stock)

  > 注：厂商库存是否突破上阈值需要考虑加工缓存，市场和精工厂下单不能考虑加工缓存

- [ ] 增加新类：精工厂类 `Refiner`

  > 即二级加工厂，对应家具厂、电器厂等，与加工厂、市场构成 加工厂-精工厂-市场 的订单生成链条
  >
  > <span id="refiner-stock">精工厂需要与加工厂具有类似的库存系统</span>
  >
  > 若本条实现，则需要实现[精工厂数据表](#refiner-table)，[精工厂兴趣点](#refiner-poi)，[精工厂数据接口](#refiner-data-interface)

- [ ] 细化订单生成逻辑

  > - [ ] 生产厂由无限库存变为拥有相对较多的初始库存，且库存按固定速率增加库存直至达到上限
  > - [ ] 生产厂库存达到上限后寻找同类生产厂中库存较少的对象，主动生成货运订单
  > - [ ] 市场下单具有冷却周期，冷却期间和已有订单期间均不会下单，冷却周期过后再根据概率按照逻辑进行检索并生成订单
  > - [ ] 加工厂下单逻辑由 低于下阈值-下单-高于上阈值 变为 在下阈值到上阈值间概率生成订单；概率与库存负相关，下阈值时取0，上阈值时取1
  > - [ ] 精工厂不仅有可能对加工厂下单，也可能对生产厂下单
  > - [ ] 市场不仅有可能对精工厂下单，也可能对加工厂下单
  >

---

## 前端

#### 仪表盘数据可视化

- [ ] 整体参数

  > 折线图：
  >
  > - [ ] 平均订单响应时间
  > - [ ] 周期平均总代价：$\Sigma 单车总代价 / 仿真周期数$
  > - [ ] 货运平均运载利用率：$\Sigma 非空闲单车有效运载比 / 非空闲车辆数$，见[有效运载比](#effective-load-ratio)
  > - [ ] 货运平均运时利用率：$\Sigma 非空闲单车有效运时比 / 非空闲车辆数$，见[有效运时比](#effective-time-ratio)
  > - [ ] 车辆空闲比：$空闲车辆数 / 车辆总数$
  > - [ ] 平均车辆闲时比：$\Sigma 单车总空闲时长 / (车辆数 * 仿真时长)$
  > - [ ] ......
  
- [ ] 个体参数

  > 散点图：
  >
  > - [ ] 车辆周期平均代价：$单车总代价 / 仿真周期数$
  >
  > - [ ] <span id="effective-load-ratio">有效运载比</span>：$荷载非零车辆当前荷载 / 核载$，荷载为 $载重$ 或 $f(载重，体积)$ 
  > - [ ] <span id="effective-time-ratio">有效运时比</span>：$荷载非零时长 / 非空闲时长$
  > - [ ] 车辆闲时比：$车辆空闲时长 / 仿真时长$
  > - [ ] ......
  >
  > 数据列表：
  >
  > - [ ] UUID
  >
  > - [ ] 车辆周期平均代价：同上，$单车总代价 = 上周期平均代价 * 上周期数 + 本周期代价$ 或 $单车总代价 = \Sigma 单周期代价$
  > - [ ] 荷载 / 核载：载重与体积分别显示
  > - [ ] 空闲时长
  > - [ ] 空驶里程数
  > - [ ] ......

#### 新增数据

- [ ] 市场兴趣点

  > 新增市场兴趣点的加载与显示

- [ ] *精工厂兴趣点*

  > <span id="refiner-poi">新增精工厂兴趣点的加载与显示</span>

#### 模拟调度

- [ ] 天气影响

  > 引入天气对货运速度、随机事件概率的影响

- [ ] 时间影响

  > 引入一天之中不同时间对货运速度、货运路径、随机事件概率的影响

#### 配置界面

- [ ] 参数配置项自适应

  > 因配置参数可能随时改动，应避免参数配置条目硬编码，根据配置文件进行自动生成配置项

- [ ] 配置界面逻辑完善

  > 配置界面至少应具备 `新建预设` `应用预设` `修改预设` `修改-取消` `修改-保存` `修改-另存为` `删除预设` 功能

#### 数据沙箱

- [ ] 数据对比界面

  > 根据沙箱数据进行对比界面编写

- [ ] 沙箱模拟界面

  > 模拟界面至少应具备 `新建沙箱` `(继续)运行` `停止运行` `删除沙箱` `加入对比` 功能

#### *代码整理*

- [ ] 整理前端代码

  > 设计前端文件结构，实现代码复用与解耦

- [ ] 统一代码风格

  > 规范缩进、命名、控制台输出等内容

- [ ] 页面重设计

  > 重新设计页面，体现专业感与高级感

---

## 前后端接口

#### 配置文件数据

- [ ] 完善可配置项

  > 根据需要的内容修改配置文件：
  >
  > - [ ] 预设名
  > - [ ] 时间步进
  > - [ ] ......

#### 模拟运行数据

- [ ] 仪表盘数据对接

  > 后端完善每周期的数据获取、缓存处理以及数据传输接口实现，前端完善数据接收与处理
  
- [ ] 兴趣点数据接口修改

  > 修改兴趣点数据接口，同步后端修改

#### 沙箱对比数据

- [ ] 前端 - 数据库桥接

  > 实现前端对比数据存入数据库逻辑以及数据库获取数据至前端逻辑

#### 新增数据适配

- [ ] 市场兴趣点

  > 新增市场兴趣点数据的后端至前端的发送逻辑及前端解析逻辑

- [ ] *精工厂兴趣点*

  > <span id="refiner-data-interface">新增精工厂兴趣点的的后端至前端的发送逻辑及前端解析逻辑</span>

---

## 杂项

#### 沙箱数据整理

- [ ] 对比数据整理

  > 整理数据沙箱模型所需要保存的对比数据

- [ ] 运行数据整理

  > 整理数据沙箱模型所需要保存的运行数据

#### 数据库修改

- [ ] 新建表：`market`

  > 设计市场类数据表

- [ ] 设计表：`*Producer, *Processor`

  > 添加新参数，重新设计表结构

- [ ] 数据沙箱

  > 设计表，储存数据沙箱所需数据

#### *数据库优化*

- [ ] 合并表：`*Producer`

  > 数据表三合一，减少表冗余及后端代码复杂度

- [ ] 合并表：`*Processor`

  > 数据表三合一，减少表冗余及后端代码复杂度

- [ ] 新建表：`Refiner`

  > <span id="refiner-table">设计精工厂类数据表</span>

#### *实时对比*

- [ ] 实现沙箱数据实时对比

  > - [ ] 后端模拟并行实现
  > - [ ] 后端并行模拟数据隔离
  > - [ ] 前端数据实时比较界面

---

## 最后的最后

- [ ] 各部统合

  > 进行代码调试整合，确保接口正确对接，数据无误，模拟结果符合预期

- [ ] 结题报告

  > UML图像绘制、公式编写、实机展示图截取、文章结构排版等，要求从零开始叙述清楚整个项目，展现项目架构以及实现内容

- [ ] 答辩PPT

  > 简明扼要地展现出本学期实现的内容
